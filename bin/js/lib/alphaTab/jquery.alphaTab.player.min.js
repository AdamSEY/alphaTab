(function(b,p){p.fn.player=function(d){var c=this;d=b.extend({player:false,playerTickCallback:null,createControls:true,caret:true,measureCaretColor:"#FFF200",measureCaretOpacity:0.25,caretOffset:{x:0,y:0},beatCaretColor:"#4040FF",beatCaretOpacity:0.75,autoScroll:true,scrollElement:"html, body",scrollAdjustment:0,language:{play:"Play",pause:"Pause",stop:"Stop",metronome:"Metronome",scrollToTop:"Scroll To Top ^",tablatureLoading:"Loading..."}},d);if(!navigator.javaEnabled()){alert("Java is not supported by your browser. The player is not available");
return this}this.updatePlayer=function(a){var f=alphatab.midi.MidiDataProvider.getSongMidiData(a,c.factory,c.tablature.viewLayout._map);if(c.midiPlayer.updateSongData){c.midiPlayer.updateSongData(f);b(c.playerControls).find("input").attr("disabled",false);c.updateCaret(0);f=b("#tracks");f.find("option").remove();for(var e=0;e<a.tracks.length;e++){var i=b('<option value="'+e+'">'+(a.tracks[e].name==""?"Track "+e:a.tracks[e].name)+"</option>");e==0&&i.attr("selected","selected");f.append(i)}}else setTimeout(function(){c.updatePlayer(a)},
1E3)};this.loadCallbacks.push(this.updatePlayer);this.updateCaret=function(a,f,e){f=f===true;e=e!==false;setTimeout(function(){c.tablature.notifyTickPosition(a,f,e)},1)};var g=b('<applet height="0" width="0"  archive="'+this.options.base+'/alphaTab.jar" code="net.alphatab.midi.MidiPlayer.class">'+(d.playerTickCallback?'<param name="onTickChanged" value="'+d.playerTickCallback+'" />':"")+"</applet>");this.midiPlayer=g[0];b(this.canvas).click(function(a){var f=b(this).offset();a=c.tablature.viewLayout.getBeatAt(a.pageX-
f.left,a.pageY-f.top);if(a!=null){a=960+a.getRealStart();c.midiPlayer.goTo(a);c.updateCaret(a,true,false)}});this.el.append(g);if(d.createControls){g=b('<div class="player"></div>');this.el.append(g);var l=b('<button class="play">'+d.language.play+"</button>"),m=b('<button class="pause">'+d.language.pause+"</button>"),k=b('<input type="checkbox" class="metronome" />'),n=b('<button class="to-top">'+d.language.scrollToTop+"</button>"),o=b('<select id="tracks"><option value="">'+d.language.tablatureLoading+
"</option></select>");g.append(o);g.append(l);g.append(m);g.append(n);g.append(b("<span>"+d.language.metronome+"</span>"));g.append(k);n.click(function(){b(d.scrollElement).animate({scrollTop:0},"slow")});l.click(function(){if(c.midiPlayer.play){k.change();c.midiPlayer.play()}else alert("The player has not loaded yet.")});m.click(function(){c.midiPlayer.pause?c.midiPlayer.pause():alert("The player has not loaded yet.")});k.change(function(){if(c.midiPlayer.setMetronomeEnabled){var a=k.attr("checked")?
true:false;c.midiPlayer.setMetronomeEnabled(a)}else alert("The player has not loaded yet.")});o.change(function(){var a=parseInt(b("#tracks :selected").val());c.tablature.setTrack(api.tablature.track.song.tracks[a]);updateCaret(c.tablature.lastPosition+960)})}if(d.caret){var h=b('<div class="measureCaret"></div>'),j=b('<div class="beatCaret"></div>');h.css({opacity:d.measureCaretOpacity,position:"absolute",background:d.measureCaretColor});j.css({opacity:d.beatCaretOpacity,position:"absolute",background:d.beatCaretColor});
h.width(0);j.width(0);h.height(0);j.height(0);this.el.append(h);this.el.append(j)}this.tablature.onCaretChanged=function(a,f){var e=b(c.canvasWrapper).offset().left+parseInt(b(c.canvas).css("borderLeftWidth"),10)+d.caretOffset.x,i=b(c.canvasWrapper).offset().top+d.caretOffset.y;i+=a.measure.staveLine.y;h.offset({top:i,left:e+a.measure.staveLine.x+a.measure.x});h.width(a.measure.width+a.measure.spacing);h.height(a.measure.staveLine.getHeight());var q=alphatab.tablature.drawing.DrawingResources.getScoreNoteSize(c.tablature.viewLayout,
false);e=e+a.fullX()+q.x/2;j.offset({top:i,left:e});j.width(3);j.height(h.height());if(f&&a.isFirstOfLine()&&d.autoScroll){e=b(d.scrollElement).offset().top+d.scrollAdjustment;b(d.scrollElement).animate({scrollTop:i+e-30},300)}};this.tablature.track!=null&&this.updatePlayer(this.tablature.track.song);return this}})(jQuery,alphaTabWrapper);
